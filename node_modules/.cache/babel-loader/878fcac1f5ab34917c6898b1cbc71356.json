{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\nimport { DEPRECATED_mountResponderInstance, DEPRECATED_unmountResponderInstance } from './ReactFiberHostConfig';\nimport { NoWork } from './ReactFiberExpirationTime';\nimport { REACT_RESPONDER_TYPE } from 'shared/ReactSymbols';\nimport invariant from 'shared/invariant';\nimport { HostComponent, HostRoot } from 'shared/ReactWorkTags';\nconst emptyObject = {};\nconst isArray = Array.isArray;\nexport function createResponderInstance(responder, responderProps, responderState, fiber) {\n  return {\n    fiber,\n    props: responderProps,\n    responder,\n    rootEventTypes: null,\n    state: responderState\n  };\n}\n\nfunction mountEventResponder(responder, responderProps, fiber, respondersMap, rootContainerInstance) {\n  let responderState = emptyObject;\n  const getInitialState = responder.getInitialState;\n\n  if (getInitialState !== null) {\n    responderState = getInitialState(responderProps);\n  }\n\n  const responderInstance = createResponderInstance(responder, responderProps, responderState, fiber);\n\n  if (!rootContainerInstance) {\n    let node = fiber;\n\n    while (node !== null) {\n      const tag = node.tag;\n\n      if (tag === HostComponent) {\n        rootContainerInstance = node.stateNode;\n        break;\n      } else if (tag === HostRoot) {\n        rootContainerInstance = node.stateNode.containerInfo;\n        break;\n      }\n\n      node = node.return;\n    }\n  }\n\n  DEPRECATED_mountResponderInstance(responder, responderInstance, responderProps, responderState, rootContainerInstance);\n  respondersMap.set(responder, responderInstance);\n}\n\nfunction updateEventListener(listener, fiber, visistedResponders, respondersMap, rootContainerInstance) {\n  let responder;\n  let props;\n\n  if (listener) {\n    responder = listener.responder;\n    props = listener.props;\n  }\n\n  invariant(responder && responder.$$typeof === REACT_RESPONDER_TYPE, 'An invalid value was used as an event listener. Expect one or many event ' + 'listeners created via React.unstable_useResponder().');\n  const listenerProps = props;\n\n  if (visistedResponders.has(responder)) {\n    // show warning\n    if (__DEV__) {\n      console.error('Duplicate event responder \"%s\" found in event listeners. ' + 'Event listeners passed to elements cannot use the same event responder more than once.', responder.displayName);\n    }\n\n    return;\n  }\n\n  visistedResponders.add(responder);\n  const responderInstance = respondersMap.get(responder);\n\n  if (responderInstance === undefined) {\n    // Mount (happens in either complete or commit phase)\n    mountEventResponder(responder, listenerProps, fiber, respondersMap, rootContainerInstance);\n  } else {\n    // Update (happens during commit phase only)\n    responderInstance.props = listenerProps;\n    responderInstance.fiber = fiber;\n  }\n}\n\nexport function updateDeprecatedEventListeners(listeners, fiber, rootContainerInstance) {\n  const visistedResponders = new Set();\n  let dependencies = fiber.dependencies;\n\n  if (listeners != null) {\n    if (dependencies === null) {\n      dependencies = fiber.dependencies = {\n        expirationTime: NoWork,\n        firstContext: null,\n        responders: new Map()\n      };\n    }\n\n    let respondersMap = dependencies.responders;\n\n    if (respondersMap === null) {\n      dependencies.responders = respondersMap = new Map();\n    }\n\n    if (isArray(listeners)) {\n      for (let i = 0, length = listeners.length; i < length; i++) {\n        const listener = listeners[i];\n        updateEventListener(listener, fiber, visistedResponders, respondersMap, rootContainerInstance);\n      }\n    } else {\n      updateEventListener(listeners, fiber, visistedResponders, respondersMap, rootContainerInstance);\n    }\n  }\n\n  if (dependencies !== null) {\n    const respondersMap = dependencies.responders;\n\n    if (respondersMap !== null) {\n      // Unmount\n      const mountedResponders = Array.from(respondersMap.keys());\n\n      for (let i = 0, length = mountedResponders.length; i < length; i++) {\n        const mountedResponder = mountedResponders[i];\n\n        if (!visistedResponders.has(mountedResponder)) {\n          const responderInstance = respondersMap.get(mountedResponder);\n          DEPRECATED_unmountResponderInstance(responderInstance);\n          respondersMap.delete(mountedResponder);\n        }\n      }\n    }\n  }\n}\nexport function createDeprecatedResponderListener(responder, props) {\n  const eventResponderListener = {\n    responder,\n    props\n  };\n\n  if (__DEV__) {\n    Object.freeze(eventResponderListener);\n  }\n\n  return eventResponderListener;\n}\nexport function unmountDeprecatedResponderListeners(fiber) {\n  const dependencies = fiber.dependencies;\n\n  if (dependencies !== null) {\n    const respondersMap = dependencies.responders;\n\n    if (respondersMap !== null) {\n      const responderInstances = Array.from(respondersMap.values());\n\n      for (let i = 0, length = responderInstances.length; i < length; i++) {\n        const responderInstance = responderInstances[i];\n        DEPRECATED_unmountResponderInstance(responderInstance);\n      }\n\n      dependencies.responders = null;\n    }\n  }\n}","map":{"version":3,"sources":["/Users/malinfeng/Desktop/mywww/react-test/src/react/packages/react-reconciler/src/ReactFiberDeprecatedEvents.js"],"names":["DEPRECATED_mountResponderInstance","DEPRECATED_unmountResponderInstance","NoWork","REACT_RESPONDER_TYPE","invariant","HostComponent","HostRoot","emptyObject","isArray","Array","createResponderInstance","responder","responderProps","responderState","fiber","props","rootEventTypes","state","mountEventResponder","respondersMap","rootContainerInstance","getInitialState","responderInstance","node","tag","stateNode","containerInfo","return","set","updateEventListener","listener","visistedResponders","$$typeof","listenerProps","has","__DEV__","console","error","displayName","add","get","undefined","updateDeprecatedEventListeners","listeners","Set","dependencies","expirationTime","firstContext","responders","Map","i","length","mountedResponders","from","keys","mountedResponder","delete","createDeprecatedResponderListener","eventResponderListener","Object","freeze","unmountDeprecatedResponderListeners","responderInstances","values"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport type {Fiber} from './ReactFiber';\nimport type {Container, Instance} from './ReactFiberHostConfig';\nimport type {\n  ReactEventResponder,\n  ReactEventResponderInstance,\n  ReactEventResponderListener,\n} from 'shared/ReactTypes';\n\nimport {\n  DEPRECATED_mountResponderInstance,\n  DEPRECATED_unmountResponderInstance,\n} from './ReactFiberHostConfig';\nimport {NoWork} from './ReactFiberExpirationTime';\n\nimport {REACT_RESPONDER_TYPE} from 'shared/ReactSymbols';\n\nimport invariant from 'shared/invariant';\nimport {HostComponent, HostRoot} from 'shared/ReactWorkTags';\n\nconst emptyObject = {};\nconst isArray = Array.isArray;\n\nexport function createResponderInstance(\n  responder: ReactEventResponder<any, any>,\n  responderProps: Object,\n  responderState: Object,\n  fiber: Fiber,\n): ReactEventResponderInstance<any, any> {\n  return {\n    fiber,\n    props: responderProps,\n    responder,\n    rootEventTypes: null,\n    state: responderState,\n  };\n}\n\nfunction mountEventResponder(\n  responder: ReactEventResponder<any, any>,\n  responderProps: Object,\n  fiber: Fiber,\n  respondersMap: Map<\n    ReactEventResponder<any, any>,\n    ReactEventResponderInstance<any, any>,\n  >,\n  rootContainerInstance: null | Container,\n) {\n  let responderState = emptyObject;\n  const getInitialState = responder.getInitialState;\n  if (getInitialState !== null) {\n    responderState = getInitialState(responderProps);\n  }\n  const responderInstance = createResponderInstance(\n    responder,\n    responderProps,\n    responderState,\n    fiber,\n  );\n\n  if (!rootContainerInstance) {\n    let node = fiber;\n    while (node !== null) {\n      const tag = node.tag;\n      if (tag === HostComponent) {\n        rootContainerInstance = node.stateNode;\n        break;\n      } else if (tag === HostRoot) {\n        rootContainerInstance = node.stateNode.containerInfo;\n        break;\n      }\n      node = node.return;\n    }\n  }\n\n  DEPRECATED_mountResponderInstance(\n    responder,\n    responderInstance,\n    responderProps,\n    responderState,\n    ((rootContainerInstance: any): Instance),\n  );\n  respondersMap.set(responder, responderInstance);\n}\n\nfunction updateEventListener(\n  listener: ReactEventResponderListener<any, any>,\n  fiber: Fiber,\n  visistedResponders: Set<ReactEventResponder<any, any>>,\n  respondersMap: Map<\n    ReactEventResponder<any, any>,\n    ReactEventResponderInstance<any, any>,\n  >,\n  rootContainerInstance: null | Container,\n): void {\n  let responder;\n  let props;\n\n  if (listener) {\n    responder = listener.responder;\n    props = listener.props;\n  }\n  invariant(\n    responder && responder.$$typeof === REACT_RESPONDER_TYPE,\n    'An invalid value was used as an event listener. Expect one or many event ' +\n      'listeners created via React.unstable_useResponder().',\n  );\n  const listenerProps = ((props: any): Object);\n  if (visistedResponders.has(responder)) {\n    // show warning\n    if (__DEV__) {\n      console.error(\n        'Duplicate event responder \"%s\" found in event listeners. ' +\n          'Event listeners passed to elements cannot use the same event responder more than once.',\n        responder.displayName,\n      );\n    }\n    return;\n  }\n  visistedResponders.add(responder);\n  const responderInstance = respondersMap.get(responder);\n\n  if (responderInstance === undefined) {\n    // Mount (happens in either complete or commit phase)\n    mountEventResponder(\n      responder,\n      listenerProps,\n      fiber,\n      respondersMap,\n      rootContainerInstance,\n    );\n  } else {\n    // Update (happens during commit phase only)\n    responderInstance.props = listenerProps;\n    responderInstance.fiber = fiber;\n  }\n}\n\nexport function updateDeprecatedEventListeners(\n  listeners: any,\n  fiber: Fiber,\n  rootContainerInstance: null | Container,\n): void {\n  const visistedResponders = new Set();\n  let dependencies = fiber.dependencies;\n  if (listeners != null) {\n    if (dependencies === null) {\n      dependencies = fiber.dependencies = {\n        expirationTime: NoWork,\n        firstContext: null,\n        responders: new Map(),\n      };\n    }\n    let respondersMap = dependencies.responders;\n    if (respondersMap === null) {\n      dependencies.responders = respondersMap = new Map();\n    }\n    if (isArray(listeners)) {\n      for (let i = 0, length = listeners.length; i < length; i++) {\n        const listener = listeners[i];\n        updateEventListener(\n          listener,\n          fiber,\n          visistedResponders,\n          respondersMap,\n          rootContainerInstance,\n        );\n      }\n    } else {\n      updateEventListener(\n        listeners,\n        fiber,\n        visistedResponders,\n        respondersMap,\n        rootContainerInstance,\n      );\n    }\n  }\n  if (dependencies !== null) {\n    const respondersMap = dependencies.responders;\n    if (respondersMap !== null) {\n      // Unmount\n      const mountedResponders = Array.from(respondersMap.keys());\n      for (let i = 0, length = mountedResponders.length; i < length; i++) {\n        const mountedResponder = mountedResponders[i];\n        if (!visistedResponders.has(mountedResponder)) {\n          const responderInstance = ((respondersMap.get(\n            mountedResponder,\n          ): any): ReactEventResponderInstance<any, any>);\n          DEPRECATED_unmountResponderInstance(responderInstance);\n          respondersMap.delete(mountedResponder);\n        }\n      }\n    }\n  }\n}\n\nexport function createDeprecatedResponderListener(\n  responder: ReactEventResponder<any, any>,\n  props: Object,\n): ReactEventResponderListener<any, any> {\n  const eventResponderListener = {\n    responder,\n    props,\n  };\n  if (__DEV__) {\n    Object.freeze(eventResponderListener);\n  }\n  return eventResponderListener;\n}\n\nexport function unmountDeprecatedResponderListeners(fiber: Fiber) {\n  const dependencies = fiber.dependencies;\n\n  if (dependencies !== null) {\n    const respondersMap = dependencies.responders;\n    if (respondersMap !== null) {\n      const responderInstances = Array.from(respondersMap.values());\n      for (let i = 0, length = responderInstances.length; i < length; i++) {\n        const responderInstance = responderInstances[i];\n        DEPRECATED_unmountResponderInstance(responderInstance);\n      }\n      dependencies.responders = null;\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}